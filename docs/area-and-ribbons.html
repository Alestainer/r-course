<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>R for Data Analysis and Visualization</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This is a course on using R focused on data analysis and visualization through case studies.">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="R for Data Analysis and Visualization" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a course on using R focused on data analysis and visualization through case studies." />
  <meta name="github-repo" content="jonpage/r-course" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R for Data Analysis and Visualization" />
  
  <meta name="twitter:description" content="This is a course on using R focused on data analysis and visualization through case studies." />
  

<meta name="author" content="Jonathan Page">


<meta name="date" content="2017-07-11">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="ggplot-exts.html">
<link rel="next" href="data-sources.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; background-color: #dddddd; }
td.sourceCode { padding-left: 5px; }
code > span.kw { font-weight: bold; } /* Keyword */
code > span.dt { color: #800000; } /* DataType */
code > span.dv { color: #0000ff; } /* DecVal */
code > span.bn { color: #0000ff; } /* BaseN */
code > span.fl { color: #800080; } /* Float */
code > span.ch { color: #ff00ff; } /* Char */
code > span.st { color: #dd0000; } /* String */
code > span.co { color: #808080; font-style: italic; } /* Comment */
code > span.al { color: #00ff00; font-weight: bold; } /* Alert */
code > span.fu { color: #000080; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #ff0000; font-weight: bold; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #ff00ff; } /* SpecialChar */
code > span.vs { color: #dd0000; } /* VerbatimString */
code > span.ss { color: #dd0000; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { font-weight: bold; } /* Preprocessor */
code > span.at { } /* Attribute */
code > span.do { color: #808080; font-style: italic; } /* Documentation */
code > span.an { color: #808080; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #808080; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #808080; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Jonathan Page R-Course</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Syllabus</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#office-hours"><i class="fa fa-check"></i>Office Hours</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#student-learning-objectives"><i class="fa fa-check"></i>Student Learning Objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#resources"><i class="fa fa-check"></i>Resources</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#required"><i class="fa fa-check"></i>Required</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#recommended"><i class="fa fa-check"></i>Recommended:</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-requirements"><i class="fa fa-check"></i>Course Requirements</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#weekly-assignments-30"><i class="fa fa-check"></i>Weekly assignments (30%)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#individual-project"><i class="fa fa-check"></i>Individual Project</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#project-assignments-30"><i class="fa fa-check"></i>Project assignments (30%)</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#project-proposal-presentation-5"><i class="fa fa-check"></i>Project proposal presentation (5%)</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#final-project-15"><i class="fa fa-check"></i>Final project (15%)</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#final-project-presentation-participation-20"><i class="fa fa-check"></i>Final project presentation participation (20%)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i>Schedule</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-1"><i class="fa fa-check"></i>Week 1</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-2"><i class="fa fa-check"></i>Week 2</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-3"><i class="fa fa-check"></i>Week 3</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-4"><i class="fa fa-check"></i>Week 4</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-5"><i class="fa fa-check"></i>Week 5</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-6"><i class="fa fa-check"></i>Week 6</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-7"><i class="fa fa-check"></i>Week 7</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-8"><i class="fa fa-check"></i>Week 8</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-9"><i class="fa fa-check"></i>Week 9</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-10"><i class="fa fa-check"></i>Week 10</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-11"><i class="fa fa-check"></i>Week 11</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-12"><i class="fa fa-check"></i>Week 12</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-13"><i class="fa fa-check"></i>Week 13</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-14"><i class="fa fa-check"></i>Week 14</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#week-15"><i class="fa fa-check"></i>Week 15</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-resources"><i class="fa fa-check"></i>Other Resources</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#statistics"><i class="fa fa-check"></i>Statistics</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#visualization"><i class="fa fa-check"></i>Visualization</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#courses"><i class="fa fa-check"></i>Courses</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#books"><i class="fa fa-check"></i>Books</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#papers"><i class="fa fa-check"></i>Papers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="individual-project-1.html"><a href="individual-project-1.html"><i class="fa fa-check"></i>Individual Project</a><ul>
<li class="chapter" data-level="" data-path="individual-project-1.html"><a href="individual-project-1.html#project-assignments"><i class="fa fa-check"></i>Project assignments</a></li>
<li class="chapter" data-level="" data-path="individual-project-1.html"><a href="individual-project-1.html#project-proposal-presentation"><i class="fa fa-check"></i>Project proposal presentation</a></li>
<li class="chapter" data-level="" data-path="individual-project-1.html"><a href="individual-project-1.html#final-project-rmarkdown"><i class="fa fa-check"></i>Final project RMarkdown</a></li>
<li class="chapter" data-level="" data-path="individual-project-1.html"><a href="individual-project-1.html#final-project-presentation-participation"><i class="fa fa-check"></i>Final project presentation participation</a></li>
</ul></li>
<li class="part"><span><b>I R Tutorials</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> R Basics</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#r-markdown"><i class="fa fa-check"></i><b>1.1</b> R Markdown</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#working-with-data-already-loaded-into-r"><i class="fa fa-check"></i><b>1.2</b> Working with data already loaded into R</a><ul>
<li class="chapter" data-level="1.2.1" data-path="intro.html"><a href="intro.html#numeric-summaries"><i class="fa fa-check"></i><b>1.2.1</b> Numeric summaries</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro.html"><a href="intro.html#visual-summaries"><i class="fa fa-check"></i><b>1.2.2</b> Visual summaries</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro.html"><a href="intro.html#distribution-plots"><i class="fa fa-check"></i><b>1.2.3</b> Distribution plots</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#assignment"><i class="fa fa-check"></i><b>1.3</b> Assignment</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="read-data.html"><a href="read-data.html"><i class="fa fa-check"></i><b>2</b> Reading data</a><ul>
<li class="chapter" data-level="2.1" data-path="read-data.html"><a href="read-data.html#data-source"><i class="fa fa-check"></i><b>2.1</b> Data Source:</a></li>
<li class="chapter" data-level="2.2" data-path="read-data.html"><a href="read-data.html#read_csv"><i class="fa fa-check"></i><b>2.2</b> <code>read_csv</code></a></li>
<li class="chapter" data-level="2.3" data-path="read-data.html"><a href="read-data.html#dplyr"><i class="fa fa-check"></i><b>2.3</b> <code>dplyr</code></a></li>
<li class="chapter" data-level="2.4" data-path="read-data.html"><a href="read-data.html#first-look-at-ggplot2"><i class="fa fa-check"></i><b>2.4</b> First Look at <code>ggplot2</code></a></li>
<li class="chapter" data-level="2.5" data-path="read-data.html"><a href="read-data.html#heatmaps"><i class="fa fa-check"></i><b>2.5</b> Heatmaps</a></li>
<li class="chapter" data-level="2.6" data-path="read-data.html"><a href="read-data.html#hexbins"><i class="fa fa-check"></i><b>2.6</b> Hexbins</a></li>
<li class="chapter" data-level="2.7" data-path="read-data.html"><a href="read-data.html#other-topics-from-this-dataset"><i class="fa fa-check"></i><b>2.7</b> Other topics from this dataset</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="facets-and-bubbles.html"><a href="facets-and-bubbles.html"><i class="fa fa-check"></i><b>3</b> Facets, Bubbles, and Transparency</a><ul>
<li class="chapter" data-level="3.1" data-path="facets-and-bubbles.html"><a href="facets-and-bubbles.html#data"><i class="fa fa-check"></i><b>3.1</b> Data</a><ul>
<li class="chapter" data-level="3.1.1" data-path="facets-and-bubbles.html"><a href="facets-and-bubbles.html#importing-non-standard-excel-files"><i class="fa fa-check"></i><b>3.1.1</b> Importing non-standard Excel files</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="facets-and-bubbles.html"><a href="facets-and-bubbles.html#facets"><i class="fa fa-check"></i><b>3.2</b> Facets</a></li>
<li class="chapter" data-level="3.3" data-path="facets-and-bubbles.html"><a href="facets-and-bubbles.html#bubbles"><i class="fa fa-check"></i><b>3.3</b> Bubbles</a></li>
<li class="chapter" data-level="3.4" data-path="facets-and-bubbles.html"><a href="facets-and-bubbles.html#transparency"><i class="fa fa-check"></i><b>3.4</b> Transparency</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lines-and-curves.html"><a href="lines-and-curves.html"><i class="fa fa-check"></i><b>4</b> Lines and Curves</a><ul>
<li class="chapter" data-level="4.1" data-path="lines-and-curves.html"><a href="lines-and-curves.html#data-1"><i class="fa fa-check"></i><b>4.1</b> Data</a></li>
<li class="chapter" data-level="4.2" data-path="lines-and-curves.html"><a href="lines-and-curves.html#geom_smooth"><i class="fa fa-check"></i><b>4.2</b> geom_smooth</a></li>
<li class="chapter" data-level="4.3" data-path="lines-and-curves.html"><a href="lines-and-curves.html#geom_abline"><i class="fa fa-check"></i><b>4.3</b> geom_abline</a></li>
<li class="chapter" data-level="4.4" data-path="lines-and-curves.html"><a href="lines-and-curves.html#geom_vline"><i class="fa fa-check"></i><b>4.4</b> geom_vline</a></li>
<li class="chapter" data-level="4.5" data-path="lines-and-curves.html"><a href="lines-and-curves.html#hline"><i class="fa fa-check"></i><b>4.5</b> hline</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ggplot-exts.html"><a href="ggplot-exts.html"><i class="fa fa-check"></i><b>5</b> ggplot2 Extensions and Scatterplot Matrices (GGally)</a><ul>
<li class="chapter" data-level="5.1" data-path="ggplot-exts.html"><a href="ggplot-exts.html#data-2"><i class="fa fa-check"></i><b>5.1</b> Data</a></li>
<li class="chapter" data-level="5.2" data-path="ggplot-exts.html"><a href="ggplot-exts.html#ggplot2-extensions"><i class="fa fa-check"></i><b>5.2</b> <a href="http://www.ggplot2-exts.org/gallery">ggplot2 extensions</a></a></li>
<li class="chapter" data-level="5.3" data-path="ggplot-exts.html"><a href="ggplot-exts.html#scatterplot-matrix-ggallyscatmat"><i class="fa fa-check"></i><b>5.3</b> scatterplot matrix (GGally::scatmat)</a></li>
<li class="chapter" data-level="5.4" data-path="ggplot-exts.html"><a href="ggplot-exts.html#ggallyglyphs"><i class="fa fa-check"></i><b>5.4</b> GGally::glyphs</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="area-and-ribbons.html"><a href="area-and-ribbons.html"><i class="fa fa-check"></i><b>6</b> geom_area and geom_ribbon</a><ul>
<li class="chapter" data-level="6.1" data-path="area-and-ribbons.html"><a href="area-and-ribbons.html#data-3"><i class="fa fa-check"></i><b>6.1</b> Data</a><ul>
<li class="chapter" data-level="6.1.1" data-path="area-and-ribbons.html"><a href="area-and-ribbons.html#downloading-a-file-from-the-internet"><i class="fa fa-check"></i><b>6.1.1</b> Downloading a file from the internet</a></li>
<li class="chapter" data-level="6.1.2" data-path="area-and-ribbons.html"><a href="area-and-ribbons.html#pairing-down-the-list-of-variables"><i class="fa fa-check"></i><b>6.1.2</b> Pairing down the list of variables</a></li>
<li class="chapter" data-level="6.1.3" data-path="area-and-ribbons.html"><a href="area-and-ribbons.html#adding-more-activity-categories"><i class="fa fa-check"></i><b>6.1.3</b> Adding more activity categories</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="area-and-ribbons.html"><a href="area-and-ribbons.html#geom_area"><i class="fa fa-check"></i><b>6.2</b> geom_area</a></li>
</ul></li>
<li class="part"><span><b>II Topics</b></span></li>
<li class="chapter" data-level="" data-path="data-sources.html"><a href="data-sources.html"><i class="fa fa-check"></i>Data Sources Overview</a><ul>
<li class="chapter" data-level="" data-path="data-sources.html"><a href="data-sources.html#macro-data"><i class="fa fa-check"></i>Macro Data</a><ul>
<li class="chapter" data-level="" data-path="data-sources.html"><a href="data-sources.html#us"><i class="fa fa-check"></i>US</a></li>
<li class="chapter" data-level="" data-path="data-sources.html"><a href="data-sources.html#other-us"><i class="fa fa-check"></i>Other US</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data-sources.html"><a href="data-sources.html#micro-data"><i class="fa fa-check"></i>Micro Data</a></li>
<li class="chapter" data-level="" data-path="data-sources.html"><a href="data-sources.html#hawaii-data"><i class="fa fa-check"></i>Hawaii Data</a></li>
<li class="chapter" data-level="" data-path="data-sources.html"><a href="data-sources.html#collections-of-data-lists"><i class="fa fa-check"></i>Collections of data lists</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="anscombe.html"><a href="anscombe.html"><i class="fa fa-check"></i>Anscombe’s Quartet</a><ul>
<li class="chapter" data-level="" data-path="anscombe.html"><a href="anscombe.html#prep-the-data"><i class="fa fa-check"></i>Prep the data</a></li>
<li class="chapter" data-level="" data-path="anscombe.html"><a href="anscombe.html#numeric-summary"><i class="fa fa-check"></i>Numeric summary</a></li>
<li class="chapter" data-level="" data-path="anscombe.html"><a href="anscombe.html#visual-summary"><i class="fa fa-check"></i>Visual summary</a></li>
<li class="chapter" data-level="" data-path="anscombe.html"><a href="anscombe.html#the-datasaurus-dozen"><i class="fa fa-check"></i>The Datasaurus Dozen</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="trifecta.html"><a href="trifecta.html"><i class="fa fa-check"></i>How to Judge Visualizations</a><ul>
<li class="chapter" data-level="" data-path="trifecta.html"><a href="trifecta.html#pre-class-assignment"><i class="fa fa-check"></i>Pre-class assignment</a></li>
<li class="chapter" data-level="" data-path="trifecta.html"><a href="trifecta.html#lecture"><i class="fa fa-check"></i>Lecture</a></li>
<li class="chapter" data-level="" data-path="trifecta.html"><a href="trifecta.html#assignment-1"><i class="fa fa-check"></i>Assignment</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Data Analysis and Visualization</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="area-and-ribbons" class="section level1">
<h1><span class="header-section-number">Lecture 6</span> geom_area and geom_ribbon</h1>
<div id="data-3" class="section level2">
<h2><span class="header-section-number">6.1</span> Data</h2>
<p>The US Bureau of Labor Statistics (BLS) conducts the American Time Use Survey (ATUS). You can download the text form of the ATUS by going to the <a href="https://www.bls.gov/data/">BLS data page</a>, finding the section labelled Spending &amp; Time Use, then clicking on the “Text Files” button on the row for the ATUS. Or by using the following link:</p>
<p><a href="https://download.bls.gov/pub/time.series/tu/" class="uri">https://download.bls.gov/pub/time.series/tu/</a></p>
<div id="downloading-a-file-from-the-internet" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Downloading a file from the internet</h3>
<p>While you can manually download the files from the above URL, <code>download.file()</code> lets you download files from within R. The first argument is the URL of the resource you want to download. The second argument is the destination for the file. The following requests will require you to create the <code>tu</code> folder.</p>
<pre><code>download.file(&quot;https://download.bls.gov/pub/time.series/tu/tu.txt&quot;, &quot;data/tu/tu.txt&quot;)
download.file(&quot;https://download.bls.gov/pub/time.series/tu/tu.series&quot;, &quot;data/tu/tu.series&quot;)
download.file(&quot;https://download.bls.gov/pub/time.series/tu/tu.data.0.Current&quot;, &quot;data/tu/tu.data.0.Current&quot;)</code></pre>
<p>The file <code>tu.txt</code> contains the documentation for the time use (tu) survey data. Section 2 of that file provides descriptions of each of the files in the <code>pub/time.series/tu</code> folder. From that list we can see that <code>tu.series</code> will give us a list of the available series.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
series_defn &lt;-<span class="st"> </span><span class="kw">read_tsv</span>(<span class="st">&quot;data/tu/tu.series&quot;</span>)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   stattype_code = col_integer(),
##   sex_code = col_integer(),
##   nmet_code = col_integer(),
##   sjmj_code = col_integer(),
##   schenr_code = col_integer(),
##   work_code = col_integer(),
##   elfreq_code = col_integer(),
##   ecytd_code = col_integer(),
##   elder_code = col_integer(),
##   begin_year = col_integer(),
##   end_year = col_integer()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">series_defn</code></pre></div>
<pre><code>## # A tibble: 85,277 × 43
##             series_id seasonal stattype_code datays_code sex_code
##                 &lt;chr&gt;    &lt;chr&gt;         &lt;int&gt;       &lt;chr&gt;    &lt;int&gt;
## 1  TUU10100AA01000007        U         10100          01        0
## 2  TUU10100AA01000013        U         10100          01        0
## 3  TUU10100AA01000014        U         10100          01        0
## 4  TUU10100AA01000015        U         10100          01        0
## 5  TUU10100AA01000018        U         10100          01        0
## 6  TUU10100AA01000019        U         10100          01        0
## 7  TUU10100AA01000025        U         10100          01        0
## 8  TUU10100AA01000035        U         10100          01        0
## 9  TUU10100AA01000036        U         10100          01        0
## 10 TUU10100AA01000037        U         10100          01        0
## # ... with 85,267 more rows, and 38 more variables: region_code &lt;chr&gt;,
## #   lfstat_code &lt;chr&gt;, educ_code &lt;chr&gt;, maritlstat_code &lt;chr&gt;,
## #   age_code &lt;chr&gt;, orig_code &lt;chr&gt;, race_code &lt;chr&gt;, mjcow_code &lt;chr&gt;,
## #   nmet_code &lt;int&gt;, where_code &lt;chr&gt;, sjmj_code &lt;int&gt;,
## #   timeday_code &lt;chr&gt;, actcode_code &lt;chr&gt;, industry_code &lt;chr&gt;,
## #   occ_code &lt;chr&gt;, prhhchild_code &lt;chr&gt;, earn_code &lt;chr&gt;,
## #   disability_code &lt;chr&gt;, who_code &lt;chr&gt;, hhnscc03_code &lt;chr&gt;,
## #   schenr_code &lt;int&gt;, prownhhchild_code &lt;chr&gt;, work_code &lt;int&gt;,
## #   elnum_code &lt;chr&gt;, ecage_code &lt;chr&gt;, elfreq_code &lt;int&gt;,
## #   eldur_code &lt;chr&gt;, elwho_code &lt;chr&gt;, ecytd_code &lt;int&gt;,
## #   elder_code &lt;int&gt;, lfstatw_code &lt;chr&gt;, pertype_code &lt;chr&gt;,
## #   series_title &lt;chr&gt;, footnote_codes &lt;chr&gt;, begin_year &lt;int&gt;,
## #   begin_period &lt;chr&gt;, end_year &lt;int&gt;, end_period &lt;chr&gt;</code></pre>
<p>There is a lot here to process. The columns we care most about for now are <code>series_id</code> and <code>series_title</code>. Using <code>select()</code> from the <code>dplyr</code> library, we can show just the columns we care about.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
series_defn %&gt;%
<span class="st">  </span><span class="kw">select</span>(series_id, series_title)</code></pre></div>
<pre><code>## # A tibble: 85,277 × 2
##             series_id
##                 &lt;chr&gt;
## 1  TUU10100AA01000007
## 2  TUU10100AA01000013
## 3  TUU10100AA01000014
## 4  TUU10100AA01000015
## 5  TUU10100AA01000018
## 6  TUU10100AA01000019
## 7  TUU10100AA01000025
## 8  TUU10100AA01000035
## 9  TUU10100AA01000036
## 10 TUU10100AA01000037
## # ... with 85,267 more rows, and 1 more variables: series_title &lt;chr&gt;</code></pre>
</div>
<div id="pairing-down-the-list-of-variables" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Pairing down the list of variables</h3>
<p>Let’s look for variables on sleep, work, and leisure:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">series_defn %&gt;%
<span class="st">  </span><span class="kw">select</span>(series_title) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">&quot;sleep&quot;</span>, series_title, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## # A tibble: 1,310 × 1
##                                                                   series_title
##                                                                          &lt;chr&gt;
## 1                                                   Avg hrs per day - Sleeping
## 2                        Avg hrs per day - Sleeping, Weekend days and holidays
## 3                              Avg hrs per day - Sleeping, Nonholiday weekdays
## 4                                         Avg hrs per day - Sleeping, Employed
## 5              Avg hrs per day - Sleeping, Weekend days and holidays, Employed
## 6                    Avg hrs per day - Sleeping, Nonholiday weekdays, Employed
## 7                         Avg hrs per day - Sleeping, Employed, on days worked
## 8  Avg hrs per day - Sleeping, Weekend days and holidays, Employed, on days wo
## 9    Avg hrs per day - Sleeping, Nonholiday weekdays, Employed, on days worked
## 10                              Avg hrs per day - Sleeping, Employed full time
## # ... with 1,300 more rows</code></pre>
<p>Since this simple search returns a ton of results, let’s further filter by ‘employed’ and ‘per day’:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">series_defn %&gt;%
<span class="st">  </span><span class="kw">select</span>(series_title) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">&quot;per day.*sleep.*employed&quot;</span>, series_title, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## # A tibble: 154 × 1
##                                                                   series_title
##                                                                          &lt;chr&gt;
## 1                                         Avg hrs per day - Sleeping, Employed
## 2              Avg hrs per day - Sleeping, Weekend days and holidays, Employed
## 3                    Avg hrs per day - Sleeping, Nonholiday weekdays, Employed
## 4                         Avg hrs per day - Sleeping, Employed, on days worked
## 5  Avg hrs per day - Sleeping, Weekend days and holidays, Employed, on days wo
## 6    Avg hrs per day - Sleeping, Nonholiday weekdays, Employed, on days worked
## 7                               Avg hrs per day - Sleeping, Employed full time
## 8    Avg hrs per day - Sleeping, Weekend days and holidays, Employed full time
## 9          Avg hrs per day - Sleeping, Nonholiday weekdays, Employed full time
## 10              Avg hrs per day - Sleeping, Employed full time, on days worked
## # ... with 144 more rows</code></pre>
<p>Now let’s filter further by ‘employed full time’, ‘nonholiday weekdays’, and ‘on days worked’:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">series_defn %&gt;%
<span class="st">  </span><span class="kw">select</span>(series_title) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">&quot;per day.*sleep.*nonholiday weekdays.*employed full time.*on days worked&quot;</span>, series_title, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## # A tibble: 6 × 1
##                                                                  series_title
##                                                                         &lt;chr&gt;
## 1 Avg hrs per day - Sleeping, Nonholiday weekdays, Employed full time, on day
## 2 Avg hrs per day - Sleeping, Nonholiday weekdays, Employed full time, on day
## 3 Avg hrs per day - Sleeping, Nonholiday weekdays, Employed full time, on day
## 4 Avg hrs per day for participants - Sleeping, Nonholiday weekdays, Employed 
## 5 Avg hrs per day for participants - Sleeping, Nonholiday weekdays, Employed 
## 6 Avg hrs per day for participants - Sleeping, Nonholiday weekdays, Employed</code></pre>
<p>Finally, let’s filter that to exclude the ‘participants only’ group and only get the Men/Women values (not the combined totals):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">series_defn %&gt;%
<span class="st">  </span><span class="kw">select</span>(series_title) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">&quot;per day -.*sleep.*nonholiday weekdays.*employed full time.*on days worked,&quot;</span>, series_title, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## # A tibble: 2 × 1
##                                                                  series_title
##                                                                         &lt;chr&gt;
## 1 Avg hrs per day - Sleeping, Nonholiday weekdays, Employed full time, on day
## 2 Avg hrs per day - Sleeping, Nonholiday weekdays, Employed full time, on day</code></pre>
</div>
<div id="adding-more-activity-categories" class="section level3">
<h3><span class="header-section-number">6.1.3</span> Adding more activity categories</h3>
<p>Now let’s add ‘work’ and ‘leisure’ to our search:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">activity &lt;-<span class="st"> </span>series_defn %&gt;%
<span class="st">  </span><span class="kw">select</span>(series_id, series_title) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">&quot;per day -.*(sleep|work|leisure).*nonholiday weekdays.*employed full time.*on days worked,&quot;</span>, series_title, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>))
activity</code></pre></div>
<pre><code>## # A tibble: 26 × 2
##             series_id
##                 &lt;chr&gt;
## 1  TUU10101AA01000344
## 2  TUU10101AA01000423
## 3  TUU10101AA01000962
## 4  TUU10101AA01001041
## 5  TUU10101AA01003012
## 6  TUU10101AA01003097
## 7  TUU10101AA01003307
## 8  TUU10101AA01003378
## 9  TUU10101AA01003947
## 10 TUU10101AA01004011
## # ... with 16 more rows, and 1 more variables: series_title &lt;chr&gt;</code></pre>
<p>Now we should create a variable that codes each of these as either work, sleep, or leisure:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">activity &lt;-<span class="st"> </span>activity %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">activity_type =</span> <span class="kw">case_when</span>(
      <span class="kw">grepl</span>(<span class="st">&quot;leisure&quot;</span>, activity$series_title, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>) ~<span class="st"> &quot;Leisure&quot;</span>,
      <span class="kw">grepl</span>(<span class="st">&quot;sleep&quot;</span>, activity$series_title, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>) ~<span class="st"> &quot;Sleep&quot;</span>,
      <span class="ot">TRUE</span> ~<span class="st"> &quot;Work&quot;</span>
    ), 
    <span class="dt">sex =</span> <span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">&quot;Men&quot;</span>, series_title), <span class="st">&quot;Men&quot;</span>, <span class="st">&quot;Women&quot;</span>)
  )
activity</code></pre></div>
<pre><code>## # A tibble: 26 × 4
##             series_id
##                 &lt;chr&gt;
## 1  TUU10101AA01000344
## 2  TUU10101AA01000423
## 3  TUU10101AA01000962
## 4  TUU10101AA01001041
## 5  TUU10101AA01003012
## 6  TUU10101AA01003097
## 7  TUU10101AA01003307
## 8  TUU10101AA01003378
## 9  TUU10101AA01003947
## 10 TUU10101AA01004011
## # ... with 16 more rows, and 3 more variables: series_title &lt;chr&gt;,
## #   activity_type &lt;chr&gt;, sex &lt;chr&gt;</code></pre>
<p>Now we can join the activity data.frame with the current data and create time series of each activity type we created.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">read_tsv</span>(<span class="st">&quot;data/tu/tu.data.0.Current&quot;</span>)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   series_id = col_character(),
##   year = col_integer(),
##   period = col_character(),
##   value = col_character(),
##   footnote_codes = col_character()
## )</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>data %&gt;%
<span class="st">  </span><span class="kw">inner_join</span>(activity) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(year, sex, activity_type) %&gt;%
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">hours =</span> <span class="kw">sum</span>(<span class="kw">as.numeric</span>(value), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## Joining, by = &quot;series_id&quot;</code></pre>
<pre><code>## Warning in evalq(sum(as.numeric(c(&quot;0.33&quot;, &quot;8.23&quot;, &quot;-&quot;, &quot;0.04&quot;, &quot;0.59&quot;,
## &quot;8.83&quot;, : NAs introduced by coercion

## Warning in evalq(sum(as.numeric(c(&quot;0.33&quot;, &quot;8.23&quot;, &quot;-&quot;, &quot;0.04&quot;, &quot;0.59&quot;,
## &quot;8.83&quot;, : NAs introduced by coercion

## Warning in evalq(sum(as.numeric(c(&quot;0.33&quot;, &quot;8.23&quot;, &quot;-&quot;, &quot;0.04&quot;, &quot;0.59&quot;,
## &quot;8.83&quot;, : NAs introduced by coercion

## Warning in evalq(sum(as.numeric(c(&quot;0.33&quot;, &quot;8.23&quot;, &quot;-&quot;, &quot;0.04&quot;, &quot;0.59&quot;,
## &quot;8.83&quot;, : NAs introduced by coercion

## Warning in evalq(sum(as.numeric(c(&quot;0.33&quot;, &quot;8.23&quot;, &quot;-&quot;, &quot;0.04&quot;, &quot;0.59&quot;,
## &quot;8.83&quot;, : NAs introduced by coercion

## Warning in evalq(sum(as.numeric(c(&quot;0.33&quot;, &quot;8.23&quot;, &quot;-&quot;, &quot;0.04&quot;, &quot;0.59&quot;,
## &quot;8.83&quot;, : NAs introduced by coercion</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data</code></pre></div>
<pre><code>## Source: local data frame [84 x 4]
## Groups: year, sex [?]
## 
##     year   sex activity_type hours
##    &lt;int&gt; &lt;chr&gt;         &lt;chr&gt; &lt;dbl&gt;
## 1   2003   Men       Leisure  8.49
## 2   2003   Men         Sleep  7.46
## 3   2003   Men          Work 19.26
## 4   2003 Women       Leisure  7.02
## 5   2003 Women         Sleep  7.65
## 6   2003 Women          Work 17.87
## 7   2004   Men       Leisure  8.66
## 8   2004   Men         Sleep  7.49
## 9   2004   Men          Work 18.92
## 10  2004 Women       Leisure  7.34
## # ... with 74 more rows</code></pre>
</div>
</div>
<div id="geom_area" class="section level2">
<h2><span class="header-section-number">6.2</span> geom_area</h2>
<p><code>geom_area</code> is useful when components that naturally add to each other:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(data, <span class="kw">aes</span>(year, hours, <span class="dt">fill=</span> activity_type)) +<span class="st"> </span><span class="kw">geom_area</span>() +<span class="st"> </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>sex) </code></pre></div>
<p><img src="jonpage-r-course_files/figure-html/unnamed-chunk-51-1.png" width="672" /> ## geom_ribbon</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">group =</span> sex, <span class="dt">fill =</span> activity_type)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">ymin =</span> -hours *<span class="st"> </span>(sex ==<span class="st"> &quot;Women&quot;</span>), <span class="dt">ymax =</span> hours *<span class="st"> </span>(sex ==<span class="st"> &quot;Men&quot;</span>)), <span class="dt">data =</span> . %&gt;%<span class="st"> </span><span class="kw">filter</span>(activity_type ==<span class="st"> &quot;Work&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) +
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">ymin =</span> -hours *<span class="st"> </span>(sex ==<span class="st"> &quot;Women&quot;</span>), <span class="dt">ymax =</span> hours *<span class="st"> </span>(sex ==<span class="st"> &quot;Men&quot;</span>)), <span class="dt">data =</span> . %&gt;%<span class="st"> </span><span class="kw">filter</span>(activity_type ==<span class="st"> &quot;Leisure&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) +
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">ymin =</span> -hours *<span class="st"> </span>(sex ==<span class="st"> &quot;Women&quot;</span>), <span class="dt">ymax =</span> hours *<span class="st"> </span>(sex ==<span class="st"> &quot;Men&quot;</span>)), <span class="dt">data =</span> . %&gt;%<span class="st"> </span><span class="kw">filter</span>(activity_type ==<span class="st"> &quot;Sleep&quot;</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) +
<span class="st">  </span><span class="kw">scale_y_continuous</span>(
    <span class="dt">name =</span> <span class="st">&quot;Average hours per work day (Fully Employed)&quot;</span>,
    <span class="dt">breaks =</span> <span class="kw">c</span>(-<span class="dv">20</span>, -<span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>),
    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Women 20 hrs&quot;</span>, <span class="st">&quot;10 hrs&quot;</span>, <span class="st">&quot;0 hrs&quot;</span>, <span class="st">&quot;10 hrs&quot;</span>, <span class="st">&quot;Men 20 hrs&quot;</span>),
    <span class="dt">limits =</span> <span class="kw">c</span>(-<span class="dv">20</span>, <span class="dv">20</span>)
    )</code></pre></div>
<p><img src="jonpage-r-course_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="ggplot-exts.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-sources.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jonpage/r-course/edit/master/08-area-and-ribbons.Rmd",
"text": "Edit"
},
"download": ["jonpage-r-course.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
